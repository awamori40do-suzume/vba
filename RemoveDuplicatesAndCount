Sub CompareBandIAndCount()
    Dim ws As Worksheet
    Dim lastRowB As Long, lastRowI As Long, rowIndex As Long
    Dim i As Long
    Dim uniqueDict As Object
    Dim key As Variant
    Dim items() As String
    Dim item As Variant
    Dim bExistsInI As Boolean
    
    Set ws = ThisWorkbook.Sheets(1) ' 対象のシートを指定
    lastRowB = ws.Cells(ws.Rows.Count, 2).End(xlUp).Row ' B列の最終行を取得
    lastRowI = ws.Cells(ws.Rows.Count, 9).End(xlUp).Row ' I列の最終行を取得 (9列目)
    Set uniqueDict = CreateObject("Scripting.Dictionary") ' Dictionaryオブジェクトを作成
    
    ' B列のデータを走査し、カウント
    For i = 1 To lastRowB
        ' B列のセルの値をカンマで分割
        items = Split(ws.Cells(i, 2).Value, ",")
        
        ' 分割した各項目を走査してカウント
        For Each item In items
            item = Trim(item) ' 余分なスペースを削除
            If item <> "" Then
                If Not uniqueDict.Exists(item) Then
                    uniqueDict.Add item, 1 ' 初めての値を追加
                Else
                    uniqueDict(item) = uniqueDict(item) + 1 ' カウントを増加
                End If
            End If
        Next item
    Next i
    
    ' I列のデータに対応してカウントをJ列に書き込む
    For i = 1 To lastRowI
        key = ws.Cells(i, 9).Value ' I列の値
        If uniqueDict.Exists(key) Then
            ws.Cells(i, 10).Value = uniqueDict(key) ' J列にカウントを書き込む
            uniqueDict.Remove key ' カウント済みのデータは削除
        Else
            ws.Cells(i, 10).Value = 0 ' B列に存在しない場合はカウントを0とする
        End If
    Next i
    
    ' I列に存在しないB列の品目をI列末尾に追加
    rowIndex = lastRowI + 1
    For Each key In uniqueDict.Keys
        ws.Cells(rowIndex, 9).Value = key ' I列の末尾に追加
        ws.Cells(rowIndex, 10).Value = uniqueDict(key) ' その横にカウントを追加
        rowIndex = rowIndex + 1
    Next key
End Sub
